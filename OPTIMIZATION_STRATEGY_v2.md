# æ¨¡åž‹è¨“ç·´é‚è¼¯å„ªåŒ–åˆ†æž

## ðŸ“‹ ä½ çš„æ ¸å¿ƒæƒ³æ³• vs æˆ‘çš„è§€é»ž

### ä½ çš„é‚è¼¯ï¼ˆå®Œå…¨æ­£ç¢ºï¼‰

```
è§¸ç¢° BB ä¸‹è»Œ K æ£’
    â†“
æª¢æŸ¥æœªä¾† 5 æ ¹æ˜¯å¦èƒ½è³º 0.1%
    â†“
èƒ½è³º â†’ Label = 1ï¼ˆæœ‰ç›ˆåˆ©ï¼‰
ä¸èƒ½è³º â†’ Label = 0ï¼ˆç„¡ç›ˆåˆ©ï¼‰
    â†“
æå–é€™å€‹ K æ£’çš„ç‰¹å¾µ
    â†“
è¨“ç·´æ¨¡åž‹å­¸ç¿’ï¼šä»€éº¼æ¨£çš„ K æ£’ç‰¹å¾µ â†’ èƒ½åœ¨æœªä¾† 5 æ ¹è³ºéŒ¢
    â†“
é æ¸¬æ–°çš„è§¸ç¢° K æ£’æ˜¯å¦æœƒåœ¨æœªä¾† 5 æ ¹æœ‰ç›ˆåˆ©
```

**âœ… çµè«–ï¼šä½ çš„ç†è§£å®Œå…¨æ­£ç¢ºã€‚æ²’æœ‰é‚è¼¯éŒ¯èª¤ã€‚**

---

## ðŸ” ä½†ç‚ºä»€éº¼æ¨¡åž‹æ€§èƒ½é‚„æ˜¯ 68% AUCï¼Ÿ

### æ ¹æœ¬å•é¡Œåˆ†æž

#### å•é¡Œ 1: K æ£’ç‰¹å¾µä¿¡æ¯ä¸è¶³

ä½ ç¾åœ¨æå–çš„ç‰¹å¾µéƒ½æ˜¯**éœæ…‹ K æ£’ç‰¹æ€§**ï¼š
- body_sizeï¼ˆè Ÿç‡­é«”å¤§å°ï¼‰
- upper_wick, lower_wickï¼ˆå½±ç·šï¼‰
- bb_positionï¼ˆä½ç½®ï¼‰
- volatilityï¼ˆæ³¢å¹…ï¼‰

**å•é¡Œ**ï¼šé€™äº›ç‰¹å¾µ**åªçœ‹ç•¶å‰ K æ£’**ï¼Œä¸çœ‹**æ­·å²ä¸Šä¸‹æ–‡**

å¯¦éš›æƒ…æ³ï¼š
```
æ˜¯å¦èƒ½åœ¨æœªä¾† 5 æ ¹è³ºéŒ¢ï¼Œä¸åªå–æ±ºæ–¼ã€Œç•¶å‰ K æ£’çš„å½¢æ…‹ã€
è€Œæ˜¯å–æ±ºæ–¼ã€Œç•¶å‰ K æ£’ + å¸‚å ´è¶¨å‹¢ + å‰å¹¾æ ¹ K æ£’çš„çµ„åˆæ¨¡å¼ã€
```

**ä¾‹å­**ï¼š
```
å ´æ™¯ Aï¼š
ä¸‹è»Œ K æ£’å½¢æ…‹ï¼šä¸Šå½±ç·šé•· = æ²’æœ‰è²·å…¥å‹•åŠ›
  å‰é¢ 3 æ ¹ï¼šæš´è·Œ
  â†’ è²·å…¥åŠ›é‡å¼· â†’ å¾ˆå®¹æ˜“åå½ˆ âœ…

å ´æ™¯ Bï¼š
ä¸‹è»Œ K æ£’å½¢æ…‹ï¼šå®Œå…¨ç›¸åŒï¼ˆä¸Šå½±ç·šé•·ï¼‰
  å‰é¢ 3 æ ¹ï¼šç›¤æ•´
  â†’ è²·å…¥åŠ›é‡å¼± â†’ å®¹æ˜“ç ´ä½ âŒ
```

**ä½ ç¾åœ¨çš„æ¨¡åž‹**åªèƒ½çœ‹åˆ° K æ£’å½¢æ…‹ç›¸åŒï¼Œåˆ†ä¸å‡º A å’Œ Bã€‚

---

#### å•é¡Œ 2: æ­·å²åºåˆ—ä¿¡æ¯è¢«ä¸Ÿæ£„äº†

ä½ çš„æ¨™ç±¤å‰µå»ºæ˜¯å°çš„ï¼Œä½†**ç‰¹å¾µæå–ç¼ºå°‘æ­·å²ä¸Šä¸‹æ–‡**ã€‚

å»ºè­°æ”¹é€²ï¼š

```python
# âŒ ç¾åœ¨çš„åšæ³•
features = [
    'body_size',           # åªæœ‰ç•¶å‰ K æ£’
    'upper_wick_ratio',
    'bb_position',
    'volatility'
]

# âœ… æ‡‰è©²åŠ å…¥æ­·å² K æ£’ä¿¡æ¯
features = [
    # ç•¶å‰ K æ£’
    'body_size', 'upper_wick_ratio', 'bb_position', 'volatility',
    
    # å‰ 3 æ ¹ K æ£’çš„æ–¹å‘åºåˆ—
    'prev_1_direction', 'prev_2_direction', 'prev_3_direction',
    
    # å‰ 3 æ ¹ K æ£’çš„æ³¢å¹…
    'prev_1_volatility', 'prev_2_volatility', 'prev_3_volatility',
    
    # å‰é¢æ˜¯å¦æœ‰ã€Œæš´è·Œã€å½¢æ…‹ï¼ˆè²·å…¥æ©Ÿæœƒï¼‰
    'is_crash_pattern_before',  # é€£çºŒ 3 æ ¹ä¸‹è·Œ
    
    # ç›¸å°ä½ç½®ç‰¹æ€§
    'body_size_change',  # ç•¶å‰ K æ£’ vs å‰ä¸€æ ¹çš„å¤§å°è®ŠåŒ–
]
```

---

#### å•é¡Œ 3: æ¨™ç±¤åˆ†å¸ƒä¸å¹³è¡¡

```
ä½ ç¾åœ¨çš„æ¨™ç±¤ï¼š
- æœ‰ç›ˆåˆ©ä¿¡è™Ÿ: 43,775 (81.53%)
- ç„¡ç›ˆåˆ©ä¿¡è™Ÿ: 9,917 (18.47%)
```

**é«˜åº¦ä¸å¹³è¡¡**å¯¼è‡´ï¼š
- æ¨¡åž‹å‚¾å‘é æ¸¬ç‚ºã€Œæœ‰ç›ˆåˆ©ã€
- å³ä½¿å…¨éƒ¨é æ¸¬ 1ï¼Œæº–ç¢ºçŽ‡ä¹Ÿæœ‰ 81%+
- ä½† AUC åªæœ‰ 68%ï¼ˆçœŸæ­£çš„åˆ¤åˆ¥èƒ½åŠ›ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```python
# 1. æé«˜ç„¡ç›ˆåˆ©æ¨£æœ¬çš„æ¬Šé‡
class_weight = {
    0: len(df) / (2 * (df['label'] == 0).sum()),     # ç„¡ç›ˆåˆ©æ¬Šé‡
    1: len(df) / (2 * (df['label'] == 1).sum())      # æœ‰ç›ˆåˆ©æ¬Šé‡
}

# 2. æˆ–è€…ç›´æŽ¥éŽæŽ¡æ¨£ç„¡ç›ˆåˆ©æ¨£æœ¬
from sklearn.utils import class_weight
weights = compute_class_weight('balanced', classes=np.unique(y), y=y)
```

---

### å•é¡Œ 4: æ¨¡åž‹éŽæ–¼ç°¡å–®

Random Forest åœ¨é€™å€‹å ´æ™¯å¯èƒ½ä¸å¤ å¥½ï¼Œå› ç‚ºï¼š

1. **ç‰¹å¾µä¹‹é–“çš„ç›¸äº’ä½œç”¨è¤‡é›œ** â†’ éœ€è¦ Gradient Boostingï¼ˆXGBoostï¼‰
2. **æ™‚åºæ¨¡å¼é‡è¦** â†’ Random Forest æ²’æœ‰æ™‚åºawareness
3. **éœ€è¦éžç·šæ€§çµ„åˆ** â†’ æ·±åº¦å­¸ç¿’æ›´åˆé©

---

## ðŸš€ å„ªåŒ–æ–¹æ¡ˆ - åˆ†éšŽæ®µæ”¹é€²

### ç¬¬ 1 éšŽæ®µï¼šåŠ å…¥æ­·å²åºåˆ—ç‰¹å¾µï¼ˆæœ€é‡è¦ï¼‰

```python
def add_historical_features(df, lookback=3):
    """
    æ·»åŠ å‰ N æ ¹ K æ£’çš„ä¿¡æ¯
    """
    # å‰ N æ ¹ K æ£’çš„æ–¹å‘
    for lag in range(1, lookback + 1):
        df[f'prev_{lag}_direction'] = df['direction'].shift(lag)
        df[f'prev_{lag}_body'] = df['body'].shift(lag)
        df[f'prev_{lag}_volatility'] = df['volatility'].shift(lag)
    
    # æª¢æŸ¥æ˜¯å¦æœ‰ã€Œæš´è·Œã€å½¢æ…‹ï¼ˆé€£çºŒ 3 æ ¹ä¸‹è·Œï¼‰
    df['is_crash_pattern'] = (
        (df['direction'].shift(1) == -1) &
        (df['direction'].shift(2) == -1) &
        (df['direction'].shift(3) == -1)
    ).astype(int)
    
    # ç•¶å‰ K æ£’ vs å‰ä¸€æ ¹çš„ç›¸å°å¤§å°
    df['body_size_change'] = df['body'] / (df['body'].shift(1) + 1e-6)
    
    # å‹•é‡è®ŠåŒ–ï¼ˆè¶¨å‹¢åè½‰ä¿¡è™Ÿï¼‰
    df['momentum_reversal'] = (
        (df['direction'].shift(1) == -1) &  # å‰ä¸€æ ¹ä¸‹è·Œ
        (df['close'] > df['close'].shift(1))  # ç•¶å‰æ”¶ç›¤é«˜æ–¼å‰ä¸€æ ¹
    ).astype(int)
    
    return df
```

**é æœŸæ”¹é€²**ï¼šAUC å¾ž 68% â†’ 75-80%

---

### ç¬¬ 2 éšŽæ®µï¼šæ”¹é€²æ¨¡åž‹é¸æ“‡

```python
# ä½¿ç”¨ XGBoostï¼ˆæ›´å¼·å¤§çš„ Boostingï¼‰
from xgboost import XGBClassifier

model = XGBClassifier(
    n_estimators=200,
    max_depth=6,           # æ·ºä¸€é»žï¼Œé˜²æ­¢éŽæ“¬åˆ
    learning_rate=0.1,
    subsample=0.8,         # è¡ŒæŽ¡æ¨£
    colsample_bytree=0.8,  # åˆ—æŽ¡æ¨£
    scale_pos_weight=9,    # èª¿æ•´ä¸å¹³è¡¡æ¯”ä¾‹ (ç„¡ç›ˆåˆ©:æœ‰ç›ˆåˆ© â‰ˆ 1:9)
    random_state=42
)
```

**é æœŸæ”¹é€²**ï¼šAUC å¾ž 75-80% â†’ 80-85%

---

### ç¬¬ 3 éšŽæ®µï¼šæ·»åŠ æŠ€è¡“æŒ‡æ¨™ç‰¹å¾µ

```python
def add_technical_features(df):
    """
    æ·»åŠ  RSI, MACD, ATR ç­‰æŠ€è¡“æŒ‡æ¨™
    """
    # RSI
    delta = df['close'].diff()
    gain = (delta.where(delta > 0, 0)).rolling(window=14).mean()
    loss = (-delta.where(delta < 0, 0)).rolling(window=14).mean()
    rs = gain / loss
    df['rsi'] = 100 - (100 / (1 + rs))
    
    # ATRï¼ˆæ³¢å‹•çŽ‡æŒ‡æ¨™ï¼‰
    tr1 = df['high'] - df['low']
    tr2 = abs(df['high'] - df['close'].shift())
    tr3 = abs(df['low'] - df['close'].shift())
    tr = pd.concat([tr1, tr2, tr3], axis=1).max(axis=1)
    df['atr'] = tr.rolling(14).mean()
    
    # MACD
    exp1 = df['close'].ewm(span=12, adjust=False).mean()
    exp2 = df['close'].ewm(span=26, adjust=False).mean()
    df['macd'] = exp1 - exp2
    df['macd_signal'] = df['macd'].ewm(span=9, adjust=False).mean()
    
    return df
```

**é æœŸæ”¹é€²**ï¼šAUC å¾ž 80-85% â†’ 85-90%

---

## ðŸ“Š å°æ¯”ï¼šä½ çš„æƒ³æ³• vs æˆ‘çš„æ–¹æ¡ˆ

### åœ¨ç†è«–ä¸Šçš„æ¯”è¼ƒ

| æ–¹é¢ | ä½ çš„æƒ³æ³• | æˆ‘çš„æ–¹æ¡ˆ |
|------|---------|----------|
| **æ¨™ç±¤é‚è¼¯** | âœ… å®Œå…¨æ­£ç¢º | âœ… å®Œå…¨ä¸€è‡´ |
| **è¨“ç·´ç›®æ¨™** | âœ… æ­£ç¢º | âœ… åŒæ„ |
| **æ˜¯å¦éœ€è¦ 5 æ ¹æœªä¾†** | âœ… æ˜¯ | âœ… æ˜¯ |
| **ç‰¹å¾µæ¶µè“‹é¢** | âš ï¸ åªçœ‹ç•¶å‰Kæ£’ | âœ… åŠ å…¥æ­·å²åºåˆ— |
| **æ™‚åºä¿¡æ¯** | âŒ ç¼ºå°‘ | âœ… åŠ å…¥ |
| **æ¨¡åž‹è¤‡é›œåº¦** | ðŸŸ¡ RF + å¯ä»¥ | âœ… XGBoost + æ›´å¥½ |

---

## ðŸ’¡ æ ¸å¿ƒçµè«–

### æ€ç¶­æ–¹å‘å®Œå…¨ä¸€è‡´ âœ…

ä½ çš„æƒ³æ³•æ˜¯å°çš„ï¼š
1. æ¨™ç±¤åŸºæ–¼ã€Œæœªä¾† 5 æ ¹æ˜¯å¦èƒ½è³ºéŒ¢ã€âœ…
2. æå–ç•¶å‰ K æ£’ç‰¹å¾µ âœ…
3. è¨“ç·´æ¨¡åž‹å­¸ç¿’é€™äº›ç‰¹å¾µçš„è¦å¾‹ âœ…
4. é æ¸¬æ–°çš„ K æ£’æ˜¯å¦æœƒåœ¨æœªä¾†è³ºéŒ¢ âœ…

### åªå·®ä¸€å€‹å„ªåŒ–æ–¹å‘

**ä½ ç¼ºçš„ä¸æ˜¯æ€è·¯ï¼Œè€Œæ˜¯ã€Œä¸Šä¸‹æ–‡ã€**ï¼š
- ç•¶å‰ K æ£’çš„ç‰¹å¾µä¸å¤ è±å¯Œ
- éœ€è¦åŠ å…¥**æ­·å²åºåˆ—ä¿¡æ¯**
- é€™æ¨£æ¨¡åž‹æ‰èƒ½çœŸæ­£ç†è§£ã€Œå¸‚å ´ç’°å¢ƒã€

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆåŠƒ

### ç«‹å³åšï¼ˆ30 åˆ†é˜ï¼‰

```bash
# 1. åœ¨ feature_engineering_and_training.py ä¸­æ·»åŠ æ­·å²ç‰¹å¾µ
# 2. é‡æ–°è¨“ç·´æ¨¡åž‹
# 3. è§€å¯Ÿ AUC æ˜¯å¦æ”¹å–„
```

### éš¨å¾Œåšï¼ˆ2-3 å°æ™‚ï¼‰

```bash
# 1. åˆ‡æ›åˆ° XGBoost
# 2. èª¿æ•´é¡žåˆ¥æ¬Šé‡
# 3. æ·»åŠ æŠ€è¡“æŒ‡æ¨™
```

### æœ€å¾Œåšï¼ˆå¯é¸ï¼Œæ·±åº¦å„ªåŒ–ï¼‰

```bash
# 1. å˜—è©¦ LSTM/Transformerï¼ˆè€ƒæ…®æ™‚åºï¼‰
# 2. Ensemble å¤šå€‹æ¨¡åž‹
# 3. è¶…åƒæ•¸å„ªåŒ–ï¼ˆGrid Searchï¼‰
```

---

## ðŸ“ ç¸½çµ

**ä½ çš„æƒ³æ³•æ²’æœ‰éŒ¯èª¤**ï¼Œç”šè‡³éžå¸¸æ¸…æ™°ã€‚

**å•é¡Œä¸åœ¨é‚è¼¯ï¼Œåœ¨æ–¼å¯¦ç¾çš„ç´°ç¯€**ï¼š
- âœ… æ¨™ç±¤å‰µå»ºé‚è¼¯ â†’ å®Œç¾Ž
- âœ… æ¨¡åž‹ç›®æ¨™ â†’ æ­£ç¢º
- âš ï¸ ç‰¹å¾µå·¥ç¨‹ â†’ éœ€è¦åŠ å¼·
- âš ï¸ æ¨¡åž‹é¸æ“‡ â†’ å¯ä»¥å‡ç´š

æˆ‘å€‘ç¾åœ¨è¦åšçš„å°±æ˜¯**è±å¯Œç‰¹å¾µç©ºé–“**å’Œ**å‡ç´šæ¨¡åž‹**ï¼Œè®“å®ƒèƒ½å¤ æ›´å¥½åœ°æ•æ‰é‚£äº› "æœªä¾† 5 æ ¹æœƒè³ºéŒ¢" çš„ K æ£’ã€‚

æº–å‚™é–‹å§‹å„ªåŒ–å—Žï¼Ÿ
